<script src="idb-utility.js"></script>
<script>
// Saat halaman selesai dimuat
document.addEventListener('DOMContentLoaded', async () => {
    const favoriteGameList = document.getElementById('favoriteGameList'); // Tempat nampilin daftar favorit
    const noFavoritesMessage = document.getElementById('noFavoritesMessage'); // Pesan kalau favorit kosong

    // Fungsi untuk ambil & tampilin semua game favorit
    async function loadFavorites() {
        const favorites = await getAllFavoriteGames(); // Ambil semua game favorit dari IndexedDB
        favoriteGameList.innerHTML = ''; // Bersihin konten sebelumnya

        // Kalau belum ada favorit
        if (favorites.length === 0) {
            noFavoritesMessage.style.display = 'block'; // Tampilkan pesan kosong
        } else {
            noFavoritesMessage.style.display = 'none'; // Sembunyikan pesan kosong

            // Loop semua game favorit & tampilin ke halaman
            favorites.forEach(game => {
                const gameCard = document.createElement('div'); // Bikin div baru
                gameCard.classList.add('game-card'); // Tambahin class CSS
                gameCard.innerHTML = `
                    <img src="${game.thumbnail}" alt="${game.title}">
                    <div class="card-content">
                        <h3>${game.title}</h3>
                        <p>${game.short_description}</p>
                        <div class="details">
                            <span>Genre: ${game.genre}</span>
                            <span>Platform: ${game.platform}</span>
                        </div>
                        <button class="remove-favorite-button" data-id="${game.id}"><i class="fas fa-trash"></i> Hapus</button>
                    </div>
                `;

                // Event listener buat hapus game dari favorit
                gameCard.querySelector('.remove-favorite-button').addEventListener('click', async (e) => {
                    const gameId = parseInt(e.target.dataset.id || e.target.closest('button').dataset.id); // Ambil ID game
                    await removeFavoriteGame(gameId); // Hapus dari IndexedDB
                    alert(`"${game.title}" dihapus dari favorit.`); // Kasih alert
                    loadFavorites(); // Refresh list favorit setelah hapus
                });

                // Event listener buat navigasi ke halaman detail game
                gameCard.addEventListener('click', (e) => {
                    // Kalau klik tombol hapus, jangan navigate ke detail
                    if (!e.target.closest('.remove-favorite-button')) {
                        window.location.href = `detail.html?id=${game.id}`; // Pindah ke halaman detail
                    }
                });

                favoriteGameList.appendChild(gameCard); // Tambahin game ke list
            });
        }
    }

    loadFavorites(); // Panggil fungsi pertama kali buat load data
});
</script>
